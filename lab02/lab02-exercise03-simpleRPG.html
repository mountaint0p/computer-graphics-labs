<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>Class 02 Mini Excercise 02</title>
	</head>
	<body>
		<script type="text/javascript">
			// Using class to represent RPG game
			// TODO: Add the following to the class
			// Enemy: if touched, player will lose and cannot move
			// Coins: if touched, player score goes up (score will be printed with map)
			// Walls: cannot be passed by player
			// These all should be passed to the class via a array of (x, y) coordinates
			class RPG {
				constructor(worldWidth, worldHeight, playerStartX, playerStartY, goalX, goalY) {
					// below line taken from <https://stackoverflow.com/q/16512182> and its answers
					this.worldState = [...Array(worldWidth)].map(_ => Array(worldHeight).fill(","));
					this.playerX = playerStartX;
					this.playerY = playerStartY;
					// IMPORTANT: we index with x first, then y
					this.worldState[playerStartX][playerStartY] = "8";
					this.worldState[goalX][goalY] = "$";
					// Status is [progress, lost, won]
					this.status = "progress";

					this.printWorld("Welcome!");
					window.addEventListener("keydown", this.keyDownFunction(this));
				}

				printWorld(messageStr) {
					console.clear();
					let worldStr = this.worldState.map(arr => arr.join("")).join("\n");
					worldStr += "\n" + messageStr;
					console.log(worldStr);
				}
				
				/* reachedGoal() {
					if (this.playerX === this.goalX && this.playerY === this.goalY) {
						this.status = "won";
						console.log("you won!");
					}
				} */

				canMoveTo(x, y) {
					// TODO: change with obstacles
					return true;  // FIXME
				}
				
				keyDownFunction(rpg_obj) {
					// Using currying to allow event listener function to use RPG class object
					function eventFunction(event) {
						let targetX = rpg_obj.playerX;
						let targetY = rpg_obj.playerY;
						if (event.key === "ArrowDown") {
							targetY += 1;
						} else if (event.key === "ArrowUp") {
							targetY -= 1;
						} else if (event.key === "ArrowRight") {
							targetX += 1;
						} else if (event.key === "ArrowLeft") {
							targetX -= 1;
						}
						// TODO: implement canMoveTo
						if (rpg_obj.canMoveTo(targetX, targetY)) {
							rpg_obj.playerX = targetX;
							rpg_obj.playerY = targetY;
							// TODO: handle intersection with coin, enemy, goal
							// for MVP just move & print
							rpg_obj.printWorld("");
						} else {
							// can't move there, so tell them & do nothing to the map
							rpg_obj.printWorld("You can't move there!");
						}
					}
					return eventFunction;
				}
			}

			let game = new RPG(10, 10, 6, 9, 1, 1);
		</script>
	</body>
</html>
